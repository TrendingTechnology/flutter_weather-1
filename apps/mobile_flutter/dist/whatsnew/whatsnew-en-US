Bug fixes and improved workflow